<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pumpkin Farmer</title>

<style>
body{
  background:#2b1b0e;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:Arial,sans-serif;
  color:white;
}
#container{display:flex;gap:20px}
#game{
  position:relative;
  width:520px;
  height:520px;
  background:#4a2d12;
  padding:6px;
  display:grid;
  grid-template-columns:repeat(10,48px);
  grid-template-rows:repeat(10,48px);
  gap:4px;
}
.tile{background:#6b3e1e}
.pumpkin{
  width:100%;
  height:100%;
  background:orange;
  border-radius:8px;
}
#player{
  position:absolute;
  width:36px;
  height:36px;
  background:#4aa3ff;
  border-radius:6px;
}
#ui{width:300px}
button{
  padding:6px;
  margin-top:6px;
  background:#8a4b1d;
  color:white;
  border:none;
  cursor:pointer;
  width:100%;
}
button:hover{background:#a85c24}
.bar{
  width:100%;
  height:14px;
  background:#3a240f;
  border-radius:6px;
  overflow:hidden;
}
.fill{height:100%;background:#4aa3ff;width:0%}
#prestigeShop{
  display:none;
  background:#3a240f;
  padding:6px;
  border-radius:6px;
  margin-top:6px;
}
</style>
</head>

<body>
<div id="container">
  <div id="game"></div>

  <div id="ui">
    <h2>üéÉ Pumpkin Farmer</h2>
    <p>Money: $<span id="money">0</span></p>
    <p>Pumpkins: <span id="count">0</span></p>

    <h3>‚≠ê Level <span id="level">1</span></h3>
    <div class="bar"><div id="xpFill" class="fill"></div></div>
    <p>Multiplier: <span id="multi">1x</span></p>

    <h3>üèÜ Prestige</h3>
    <p>Points: <span id="prestigePoints">0</span></p>
    <button id="prestigeBtn"></button>

    <button onclick="togglePrestigeShop()">üß¨ Prestige Shop</button>
    <div id="prestigeShop">
      <button id="pSpeedBtn" onclick="buyPrestigeSpeed()"></button>
      <button id="pAreaBtn" onclick="buyPrestigeArea()"></button>
      <button id="pRegenBtn" onclick="buyPrestigeRegen()"></button>
    </div>

    <h3>üõí Upgrades</h3>
    <button id="speedBtn" onclick="buyMaxSpeed()"></button>
    <button id="valueBtn" onclick="buyMaxValue()"></button>
    <button id="regenBtn" onclick="buyMaxRegen()"></button>

    <h3>üíæ Save</h3>
    <button onclick="saveGame()">Save</button>
    <button onclick="resetGame()" style="background:#a84444">Reset</button>
  </div>
</div>

<script>
/* ===== FORMAT ===== */
function format(n){
  if(n<1000) return Math.floor(n);
  const u=["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No"];
  const e=Math.floor(Math.log10(n)/3);
  return (n/Math.pow(1000,e)).toFixed(2)+(u[e-1]||"e"+e*3);
}

/* ===== CONSTANTS ===== */
const SIZE=10,TILE=48,GAP=4,PAD=6;
const PLAYER=36;
const GAME_SIZE=PAD*2 + SIZE*TILE + (SIZE-1)*GAP;

const game=document.getElementById("game");

/* ===== STATE ===== */
let money=0,pumpkins=0,level=1,xp=0,xpNeed=10,mult=1;
let prestigePoints=0;

const speedBase=2.2;
let speedLv=1,maxSpeed=25;
let value=1,valueLv=1,regen=3000,regenLv=1;

let pSpeedLv=0,pAreaLv=0;
const pMax=10;
let pSpeedCost=100000,pAreaCost=100000;

let pRegenBought=false;
const pRegenCost=1e27; // 1 octillion

let speed=0;
let keys={},tiles=[],uiDirty=true;

/* ===== CALCS ===== */
function recalcSpeed(){
  speed=(speedBase+(speedLv-1)*0.6)*(1+pSpeedLv*0.15);
}
function farmRadius(){
  return 18 + pAreaLv*12;
}

/* ===== DOM ===== */
const moneyEl=document.getElementById("money");
const countEl=document.getElementById("count");
const levelEl=document.getElementById("level");
const xpFill=document.getElementById("xpFill");
const multiEl=document.getElementById("multi");
const prestigeEl=document.getElementById("prestigePoints");
const prestigeBtn=document.getElementById("prestigeBtn");

const speedBtn=document.getElementById("speedBtn");
const valueBtn=document.getElementById("valueBtn");
const regenBtn=document.getElementById("regenBtn");
const pSpeedBtn=document.getElementById("pSpeedBtn");
const pAreaBtn=document.getElementById("pAreaBtn");
const pRegenBtn=document.getElementById("pRegenBtn");

/* ===== FARM SETUP ===== */
for(let y=0;y<SIZE;y++){
  for(let x=0;x<SIZE;x++){
    const t=document.createElement("div");
    t.className="tile";
    const p=document.createElement("div");
    p.className="pumpkin";
    t.appendChild(p);
    t._pos={x:PAD+x*(TILE+GAP),y:PAD+y*(TILE+GAP)};
    game.appendChild(t);
    tiles.push(t);
  }
}

const player=document.createElement("div");
player.id="player";
game.appendChild(player);
let pos={x:PAD+6,y:PAD+6};

/* ===== INPUT ===== */
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

/* ===== FARMING ===== */
function overlapCircle(px,py,tx,ty,r){
  const cx=tx+TILE/2,cy=ty+TILE/2;
  return Math.hypot(px-cx,py-cy)<=r;
}

function farm(){
  const r=farmRadius();
  const px=pos.x+PLAYER/2,py=pos.y+PLAYER/2;
  for(const t of tiles){
    const p=t.firstChild;
    if(p.style.display==="none") continue;
    if(overlapCircle(px,py,t._pos.x,t._pos.y,r)){
      p.style.display="none";
      pumpkins++;
      money+=value*mult;
      xp++;
      if(xp>=xpNeed){
        xp=0;level++;
        xpNeed=Math.floor(xpNeed*1.4);
        mult*=1.1;
      }
      uiDirty=true;
      setTimeout(()=>p.style.display="block",regen);
    }
  }
}

/* ===== GAME LOOP ===== */
function update(){
  let moved=false;
  if(keys.w||keys.ArrowUp){pos.y-=speed;moved=true}
  if(keys.s||keys.ArrowDown){pos.y+=speed;moved=true}
  if(keys.a||keys.ArrowLeft){pos.x-=speed;moved=true}
  if(keys.d||keys.ArrowRight){pos.x+=speed;moved=true}

  /* üîí CLAMP TO FARM BORDERS */
  pos.x=Math.max(PAD,Math.min(GAME_SIZE-PAD-PLAYER,pos.x));
  pos.y=Math.max(PAD,Math.min(GAME_SIZE-PAD-PLAYER,pos.y));

  if(moved){
    player.style.left=pos.x+"px";
    player.style.top=pos.y+"px";
    farm();
  }
  requestAnimationFrame(update);
}

/* ===== UI ===== */
function prestigeGain(){return Math.floor(money/1e6)}

function updateUI(){
  moneyEl.textContent=format(money);
  countEl.textContent=format(pumpkins);
  levelEl.textContent=level;
  multiEl.textContent=mult.toFixed(2)+"x";
  xpFill.style.width=(xp/xpNeed*100)+"%";
  prestigeEl.textContent=format(prestigePoints);

  speedBtn.textContent=speedLv>=maxSpeed?"Speed MAX":`Speed Lv ${speedLv} ($10)`;
  valueBtn.textContent=`Value Lv ${valueLv} ($15)`;
  regenBtn.textContent=`Regen Lv ${regenLv} ($20)`;

  pSpeedBtn.textContent=pSpeedLv>=pMax
    ?"Prestige Speed MAX"
    :`Prestige Speed Lv ${pSpeedLv} (${format(pSpeedCost)} PP)`;

  pAreaBtn.textContent=pAreaLv>=pMax
    ?"Farming Area MAX"
    :`Farming Area Lv ${pAreaCost} (${format(pAreaCost)} PP)`;

  pRegenBtn.textContent = pRegenBought
    ? "‚ö° Prestige Regen Speed (BOUGHT)"
    : `‚ö° Prestige Regen Speed (${format(pRegenCost)} PP)`;
  pRegenBtn.disabled = pRegenBought;

  prestigeBtn.textContent=`Prestige (Gain ${format(prestigeGain())})`;
}

function uiLoop(){
  if(uiDirty){updateUI();uiDirty=false}
  requestAnimationFrame(uiLoop);
}

/* ===== UPGRADES ===== */
function buyMaxSpeed(){
  const cost=10;
  const can=Math.min(maxSpeed-speedLv,Math.floor(money/cost));
  if(can<=0) return;
  money-=can*cost;
  speedLv+=can;
  recalcSpeed();
  uiDirty=true;
}
function buyMaxValue(){
  const cost=15;
  const can=Math.floor(money/cost);
  if(can<=0) return;
  money-=can*cost;
  value+=can;
  valueLv+=can;
  uiDirty=true;
}
function buyMaxRegen(){
  const cost=20;
  const can=Math.floor(money/cost);
  if(can<=0) return;
  money-=can*cost;
  regen=Math.max(500,regen-can*400);
  regenLv+=can;
  uiDirty=true;
}

/* ===== PRESTIGE ===== */
prestigeBtn.onclick=()=>{
  const g=prestigeGain();
  if(!g) return alert("Not enough money");
  prestigePoints+=g;
  money=pumpkins=0;
  level=1;xp=0;xpNeed=10;mult=1;
  speedLv=1;value=1;valueLv=1;
  regen = pRegenBought ? 50 : 3000;
  regenLv=1;
  recalcSpeed();
  uiDirty=true;
};

/* ===== PRESTIGE SHOP ===== */
function togglePrestigeShop(){
  const s=document.getElementById("prestigeShop");
  s.style.display=s.style.display==="none"?"block":"none";
}
function buyPrestigeSpeed(){
  if(pSpeedLv>=pMax||prestigePoints<pSpeedCost) return;
  prestigePoints-=pSpeedCost;
  pSpeedLv++;
  pSpeedCost=Math.floor(pSpeedCost*2.1);
  recalcSpeed();
  uiDirty=true;
}
function buyPrestigeArea(){
  if(pAreaLv>=pMax||prestigePoints<pAreaCost) return;
  prestigePoints-=pAreaCost;
  pAreaLv++;
  pAreaCost=Math.floor(pAreaCost*2.1);
  uiDirty=true;
}
function buyPrestigeRegen(){
  if(pRegenBought) return;
  if(prestigePoints < pRegenCost) return;

  prestigePoints -= pRegenCost;
  pRegenBought = true;
  regen = 50;
  uiDirty = true;
}

/* ===== SAVE ===== */
function saveGame(){
  localStorage.setItem("pumpkinSave",JSON.stringify({
    money,pumpkins,level,xp,xpNeed,mult,prestigePoints,
    speedLv,value,valueLv,regen,regenLv,
    pSpeedLv,pSpeedCost,pAreaLv,pAreaCost,
    pRegenBought
  }));
}
function resetGame(){
  localStorage.removeItem("pumpkinSave");
  location.reload();
}
(function load(){
  const s=JSON.parse(localStorage.getItem("pumpkinSave"));
  if(s) Object.assign(window,s);
  if(pRegenBought) regen = 50;
  recalcSpeed();
  uiDirty=true;
})();

recalcSpeed();
update();
uiLoop();
</script>
</body>
</html>



