<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pumpkin Farmer (Prestige Preview)</title>

<style>
body {
  background:#2b1b0e;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
  font-family:Arial, sans-serif;
  color:white;
}
#container { display:flex; gap:20px; }
#game {
  position:relative;
  width:520px;
  height:520px;
  background:#4a2d12;
  padding:6px;
  display:grid;
  grid-template-columns:repeat(10, 48px);
  grid-template-rows:repeat(10, 48px);
  gap:4px;
}
.tile { background:#6b3e1e; }
.pumpkin {
  width:100%;
  height:100%;
  background:orange;
  border-radius:8px;
}
#player {
  position:absolute;
  width:36px;
  height:36px;
  background:#4aa3ff;
  border-radius:6px;
}
#ui { width:300px; }
button {
  padding:6px;
  margin-top:6px;
  background:#8a4b1d;
  color:white;
  border:none;
  cursor:pointer;
}
button:hover { background:#a85c24; }
.bar {
  width:100%;
  height:14px;
  background:#3a240f;
  border-radius:6px;
  overflow:hidden;
}
.fill { height:100%; background:#4aa3ff; width:0%; }
</style>
</head>
<body>

<div id="container">
  <div id="game"></div>
  <div id="ui">
    <h2>üéÉ Pumpkin Farmer</h2>
    <p>Money: $<span id="money">0</span></p>
    <p>Pumpkins: <span id="count">0</span></p>

    <h3>‚≠ê Level <span id="level">1</span></h3>
    <div class="bar"><div id="xpFill" class="fill"></div></div>
    <p>Multiplier: <span id="multi">1x</span></p>

    <h3>üèÜ Prestige</h3>
    <p>Points: <span id="prestigePoints">0</span></p>
    <button id="prestigeBtn">Prestige (0)</button>

    <h3>üõí Upgrades</h3>
    <button id="speedBtn" onclick="buyMaxSpeed()"></button>
    <button id="valueBtn" onclick="buyMaxValue()"></button>
    <button id="regenBtn" onclick="buyMaxRegen()"></button>

    <h3>üíæ Save</h3>
    <button onclick="saveGame()">Save</button>
    <button onclick="resetGame()" style="background:#a84444;">Reset</button>
  </div>
</div>

<script>
/* ===== FAST NUMBER FORMAT ===== */
function format(n){
  if(n < 1000) return Math.floor(n);
  const u=["K","M","B","T","Qa","Qi","Sx","Sp","Oc","No"];
  const e=Math.floor(Math.log10(n)/3);
  return (n/Math.pow(1000,e)).toFixed(2)+(u[e-1]||"e"+e*3);
}

/* ===== CONSTANTS ===== */
const SIZE=10,TILE=48,GAP=4,PAD=6;
const game=document.getElementById("game");

/* ===== STATE ===== */
let money=0,pumpkins=0,level=1,xp=0,xpNeed=10,mult=1;
let prestigePoints=0;
let speed=2.2,speedLv=1,maxSpeed=25;
let value=1,valueLv=1,regen=3000,regenLv=1;
let keys={},tiles=[],uiDirty=true;

/* ===== DOM ===== */
const moneyEl=document.getElementById("money");
const countEl=document.getElementById("count");
const levelEl=document.getElementById("level");
const xpFill=document.getElementById("xpFill");
const multiEl=document.getElementById("multi");
const prestigeEl=document.getElementById("prestigePoints");
const prestigeBtn=document.getElementById("prestigeBtn");

const speedBtn=document.getElementById("speedBtn");
const valueBtn=document.getElementById("valueBtn");
const regenBtn=document.getElementById("regenBtn");

/* ===== FARM SETUP ===== */
for(let y=0;y<SIZE;y++){
  for(let x=0;x<SIZE;x++){
    const t=document.createElement("div");
    t.className="tile";
    const p=document.createElement("div");
    p.className="pumpkin";
    t.appendChild(p);
    t._pos={x:PAD+x*(TILE+GAP),y:PAD+y*(TILE+GAP)};
    game.appendChild(t);
    tiles.push(t);
  }
}

const player=document.createElement("div");
player.id="player";
game.appendChild(player);
let pos={x:PAD+6,y:PAD+6};

/* ===== INPUT ===== */
addEventListener("keydown",e=>keys[e.key]=true);
addEventListener("keyup",e=>keys[e.key]=false);

/* ===== GAME LOOP ===== */
function overlap(a,b){
  return !(a.x+a.w<b.x||a.x>b.x+b.w||a.y+a.h<b.y||a.y>b.y+b.h);
}

function farm(){
  const pr={x:pos.x,y:pos.y,w:36,h:36};
  for(const t of tiles){
    const p=t.firstChild;
    if(p.style.display==="none") continue;
    if(overlap(pr,{...t._pos,w:TILE,h:TILE})){
      p.style.display="none";
      pumpkins++;
      money+=value*mult;
      xp++;
      if(xp>=xpNeed){
        xp=0; level++;
        xpNeed=Math.floor(xpNeed*1.4);
        mult*=1.1;
      }
      uiDirty=true;
      setTimeout(()=>p.style.display="block",regen);
    }
  }
}

function update(){
  let moved=false;
  if(keys.w||keys.ArrowUp){pos.y-=speed;moved=true;}
  if(keys.s||keys.ArrowDown){pos.y+=speed;moved=true;}
  if(keys.a||keys.ArrowLeft){pos.x-=speed;moved=true;}
  if(keys.d||keys.ArrowRight){pos.x+=speed;moved=true;}
  if(moved){
    player.style.left=pos.x+"px";
    player.style.top=pos.y+"px";
    farm();
  }
  requestAnimationFrame(update);
}

/* ===== UI LOOP ===== */
function prestigeGain(){ return Math.floor(money/1e6); }

function updateUI(){
  moneyEl.textContent=format(money);
  countEl.textContent=format(pumpkins);
  levelEl.textContent=level;
  multiEl.textContent=mult.toFixed(2)+"x";
  xpFill.style.width=(xp/xpNeed*100)+"%";
  prestigeEl.textContent=format(prestigePoints);

  // Show upgrades with current level
  speedBtn.textContent=speedLv>=maxSpeed?"Speed MAX":`Speed Lv ${speedLv} ($10)`;
  valueBtn.textContent=`Value Lv ${valueLv} ($15)`;
  regenBtn.textContent=`Regen Lv ${regenLv} ($20)`;

  // Show potential prestige points
  prestigeBtn.textContent=`Prestige (Will get ${format(prestigeGain())})`;
}

function uiLoop(){
  if(uiDirty){updateUI();uiDirty=false;}
  requestAnimationFrame(uiLoop);
}

/* ===== UPGRADES ===== */
function buyMaxSpeed(){
  const cost=10;
  const can=Math.min(maxSpeed-speedLv,Math.floor(money/cost));
  if(can<=0) return;
  money-=can*cost;
  speedLv+=can;
  speed+=can*0.6;
  uiDirty=true;
}
function buyMaxValue(){
  const cost=15;
  const can=Math.floor(money/cost);
  if(can<=0) return;
  money-=can*cost;
  value+=can;
  valueLv+=can;
  uiDirty=true;
}
function buyMaxRegen(){
  const cost=20;
  const can=Math.floor(money/cost);
  if(can<=0) return;
  money-=can*cost;
  regen=Math.max(500,regen-can*400);
  regenLv+=can;
  uiDirty=true;
}

/* ===== PRESTIGE ===== */
prestigeBtn.onclick=()=>{
  const g=prestigeGain();
  if(!g) return alert("Not enough money");
  prestigePoints+=g;
  money=pumpkins=0;
  level=1;xp=0;xpNeed=10;mult=1;
  speed=2.2;speedLv=1;value=1;valueLv=1;regen=3000;regenLv=1;
  uiDirty=true;
};

/* ===== SAVE ===== */
function saveGame(){
  localStorage.setItem("pumpkinSave",JSON.stringify({
    money,pumpkins,level,xp,xpNeed,mult,prestigePoints,
    speed,speedLv,value,valueLv,regen,regenLv
  }));
}
function resetGame(){
  localStorage.removeItem("pumpkinSave");
  location.reload();
}
(function load(){
  const s=JSON.parse(localStorage.getItem("pumpkinSave"));
  if(s) Object.assign(window,s);
  uiDirty=true;
})();

update();
uiLoop();
</script>
</body>
</html>
